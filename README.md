# Malware Analysis Report

XYZCORP Malware Analysis

Brennan St. John

# Executive Summary

This report outlines a multi-stage malware attack beginning with a malicious Excel spreadsheet (**6E4B5944B198D0E58162EBA1BE68DBB3.xls**). The malware employs sophisticated evasion techniques and leverages PowerShell for potential data exfiltration. Upon detection of analysis tools, it modifies its behavior to evade detection and ensure persistence. The primary risk to the organization includes unauthorized data access and system compromise. Remediation involves identifying affected systems using specific indicators of compromise and implementing a comprehensive removal process. The complexity of remediation is moderate, requiring specialized tools and knowledge of malware behavior.

# Initial Sample

| Name | 6E4B5944B198D0E58162EBA1BE68DBB3.xls |
| --- | --- |
| Size | 3,953,664 bytes |
| Type | Composite Document File V2 Document |
| MD5 | 4c893dc91d8a1c86c3f54eb2a5861e37 |

## Description

The Excel file contains a macro designed to execute upon workbook closure, collecting the user's username and executing concealed commands. The macro creates a file, **b.png**, in the TEMP directory, which contains data for another executable, **uiop.exe**. This process demonstrates the malware's initial deployment and evasion tactics.

![!images/Figure%201.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%201.png)

Figure 1 - The initial sample doesn't include a call to action regarding the embedded macro

[](#_Table_of_Figures)

![!images/Figure%202.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%202.png)

Figure 2 - Macro Analysis Revealing User Data Collection and Execution Tactics

![!images/Figure%203.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%203.png)

Figure 3 – Uncovering the Very Hidden "uiwez" Sheet with Obfuscated Content, using oledump and plugin_biff

![!images/Figure%204.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%204.png)

Figure 4 – Detail of the "uiwez" Sheet's Obfuscated Commands Revealed, after unhiding the sheet and changing font color

# Sample 2

| Name | uiop.exe |
| --- | --- |
| Size | 14,848 bytes |
| Type | PE32+ executable (GUI)(console) |
| MD5 | 32c7b8ee0e6384b3d8d0b07d6d8533de |

## Description

Upon execution, **uiop.exe** assesses the presence of analysis tools by checking for the **chocolatey** folder. If not found, it deletes itself and relocates as **zxcv.exe** to the Program Files directory, from where it attempts to execute PowerShell commands for further malicious activities.

![!images/Figure%205.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%205.png)

Figure 5 – After running the macro inside of Excel, b.png and uiop.exe are in the Temp folder

![!images/Figure%206.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%206.png)

Figure 6 – Examination of **uiop.exe** Strings Indicating Malicious Intent

# Sample 3

| Name | zxcv.exe |
| --- | --- |
| Size | 14,848 bytes |
| Type | PE32+ executable (GUI)(console) |
| MD5 | 32c7b8ee0e6384b3d8d0b07d6d8533de |

## Description

**zxcv.exe** represents the malware's final form, attempting to exfiltrate data via PowerShell. It targets user data on the desktop, encoding and attempting to send this information to a remote server, which fails due to the server being unreachable.

![!images/Figure%207.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%207.png)

Figure 7 – **zxcv.exe** Detected Running and Opening PowerShell for Execution periodically, using procexp

![!images/Figure%208.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%208.png)

Figure 8 – **zxcv.exe** Positioned in the Program Files Directory Post Deletion of **uiop.exe**

![!images/Figure%209.png](https://github.com/BrennanStJohn/Sample_Malware_Analysis/blob/43b508b891a5619795e1360ff0666d9c033d97d9/images/Figure%209.png)

Figure 9 – PowerShell Commands Executed by **zxcv.exe** Aiming for Data Exfiltration, using our PS logs

# Indicators of Compromise

- Files: **b.png**, **uiop.exe**, **zxcv.exe**uiop.exe
- PowerShell commands attempting to contact **longfakedsudomainthatisnotrealorreachable.org**

# Remediation

- **Identification:** Utilize the IOCs to scan and identify affected systems. Tools such as antivirus and EDR solutions should be updated to detect these specific artifacts.
- **Isolation:** Disconnect identified systems from the network to prevent further data loss or spread of malware.
- **Removal:** Manually delete identified files (**b.png**, **uiop.exe**, **zxcv.exe**) and reverse any known registry changes. Running antivirus scans in safe mode may be necessary for thorough cleaning.
- **Recovery:** Restore affected systems from clean backups. In cases of significant compromise, a full system reinstallation may be warranted.
- **Post-Remediation:** Update security solutions and conduct a review of security policies to prevent future incidents. Implement user education programs to raise awareness about phishing and other malware deployment tactics.

# Summary

This report has detailed the discovery, analysis, and recommended remediation steps for a sophisticated malware attack initiated through an Excel document. The malware's capability to adapt its behavior to evade detection and attempt data exfiltration poses a significant threat. Through diligent application of the outlined remediation steps and ongoing vigilance, the organization can mitigate the risk posed by this and similar malware threats.
